<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTAI API: rtai-core/include/rtai_mbx.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>rtai-core/include/rtai_mbx.h</h1><a href="rtai__mbx_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00024 <span class="preprocessor">#ifndef _RTAI_MBX_H</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define _RTAI_MBX_H</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#include &lt;<a class="code" href="rtai__sem_8h.html">rtai_sem.h</a>&gt;</span>
00028 
00029 <span class="keyword">struct </span>rt_task_struct;
00030 <span class="keyword">struct </span>rt_mailbox;
00031 
00032 <span class="preprocessor">#ifdef __KERNEL__</span>
00033 <span class="preprocessor"></span>
00034 <span class="preprocessor">#ifdef CONFIG_RTAI_MBX_BUILTIN</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define MBX_INIT_MODULE     mbx_init_module</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define MBX_CLEANUP_MODULE  mbx_cleanup_module</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#else  </span><span class="comment">/* !CONFIG_RTAI_MBX_BUILTIN */</span>
00038 <span class="preprocessor">#define MBX_INIT_MODULE     init_module</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define MBX_CLEANUP_MODULE  cleanup_module</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* CONFIG_RTAI_MBX_BUILTIN */</span>
00041 
00042 <span class="preprocessor">#ifndef __cplusplus</span>
00043 <span class="preprocessor"></span>
00044 <span class="keyword">typedef</span> <span class="keyword">struct </span>rt_mailbox {
00045 
00046     <span class="keywordtype">int</span> magic;
00047     SEM sndsem, rcvsem;
00048     <span class="keyword">struct </span>rt_task_struct *waiting_task, *owndby;
00049     <span class="keywordtype">char</span> *bufadr;
00050     <span class="keywordtype">int</span> size, fbyte, lbyte, avbs, frbs;
00051     spinlock_t lock;
00052 
00053 } MBX;
00054 
00055 <span class="preprocessor">#else </span><span class="comment">/* __cplusplus */</span>
00056 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00057 <span class="preprocessor">#endif </span><span class="comment">/* !__cplusplus */</span>
00058 
00059 <span class="keywordtype">int</span> MBX_INIT_MODULE(<span class="keywordtype">void</span>);
00060 
00061 <span class="keywordtype">void</span> MBX_CLEANUP_MODULE(<span class="keywordtype">void</span>);
00062 
00063 <span class="keywordtype">int</span> rt_typed_mbx_init(<span class="keyword">struct</span> rt_mailbox *mbx,
00064                       <span class="keywordtype">int</span> size,
00065                       <span class="keywordtype">int</span> qtype);
00066 
00067 <span class="keywordtype">int</span> <a class="code" href="group__lxrt.html#a337">rt_mbx_init</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00068                 <span class="keywordtype">int</span> size);
00069 
00070 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a12">rt_mbx_delete</a>(<span class="keyword">struct</span> rt_mailbox *mbx);
00071 
00072 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a13">rt_mbx_send</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00073                 <span class="keywordtype">void</span> *msg,
00074                 <span class="keywordtype">int</span> msg_size);
00075 
00076 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a14">rt_mbx_send_wp</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00077                    <span class="keywordtype">void</span> *msg,
00078                    <span class="keywordtype">int</span> msg_size);
00079 
00080 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a15">rt_mbx_send_if</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00081                    <span class="keywordtype">void</span> *msg,
00082                    <span class="keywordtype">int</span> msg_size);
00083 
00084 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a16">rt_mbx_send_until</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00085                       <span class="keywordtype">void</span> *msg,
00086                       <span class="keywordtype">int</span> msg_size,
00087                       RTIME time);
00088 
00089 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a17">rt_mbx_send_timed</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00090                       <span class="keywordtype">void</span> *msg,
00091                       <span class="keywordtype">int</span> msg_size,
00092                       RTIME delay);
00093 
00094 <span class="keywordtype">int</span> rt_mbx_ovrwr_send(<span class="keyword">struct</span> rt_mailbox *mbx,
00095                       <span class="keywordtype">void</span> *msg,
00096                       <span class="keywordtype">int</span> msg_size);
00097 
00098 <span class="keywordtype">int</span> rt_mbx_evdrp(<span class="keyword">struct</span> rt_mailbox *mbx,
00099                  <span class="keywordtype">void</span> *msg,
00100                  <span class="keywordtype">int</span> msg_size);
00101 
00102 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a18">rt_mbx_receive</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00103                    <span class="keywordtype">void</span> *msg,
00104                    <span class="keywordtype">int</span> msg_size);
00105 
00106 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a19">rt_mbx_receive_wp</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00107                       <span class="keywordtype">void</span> *msg,
00108                       <span class="keywordtype">int</span> msg_size);
00109 
00110 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a20">rt_mbx_receive_if</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00111                       <span class="keywordtype">void</span> *msg,
00112                       <span class="keywordtype">int</span> msg_size);
00113 
00114 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a21">rt_mbx_receive_until</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00115                          <span class="keywordtype">void</span> *msg,
00116                          <span class="keywordtype">int</span> msg_size,
00117                          RTIME time);
00118 
00119 <span class="keywordtype">int</span> <a class="code" href="group__mbx.html#a22">rt_mbx_receive_timed</a>(<span class="keyword">struct</span> rt_mailbox *mbx,
00120                          <span class="keywordtype">void</span> *msg,
00121                          <span class="keywordtype">int</span> msg_size,
00122                          RTIME delay);
00123 
00124 <span class="keyword">struct </span>rt_mailbox *rt_typed_named_mbx_init(<span class="keyword">const</span> <span class="keywordtype">char</span> *mbx_name,
00125                                            <span class="keywordtype">int</span> size,
00126                                            <span class="keywordtype">int</span> qtype);
00127 
00128 <span class="keywordtype">int</span> rt_named_mbx_delete(<span class="keyword">struct</span> rt_mailbox *mbx);
00129 
00130 <span class="preprocessor">#define rt_named_mbx_init(mbx_name, size)  rt_typed_named_mbx_init(mbx_name, size, FIFO_Q)</span>
00131 <span class="preprocessor"></span>
00132 <span class="preprocessor">#ifdef __cplusplus</span>
00133 <span class="preprocessor"></span>}
00134 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00135 
00136 <span class="preprocessor">#else </span><span class="comment">/* !__KERNEL__ */</span>
00137 
00138 <span class="preprocessor">#include &lt;<a class="code" href="rtai__lxrt_8h.html">rtai_lxrt.h</a>&gt;</span>
00139 
00140 <span class="preprocessor">#ifdef __cplusplus</span>
00141 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00142 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00143 
00144 RTAI_PROTO(<span class="keywordtype">void</span> *,rt_typed_mbx_init,(<span class="keywordtype">int</span> name, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> qtype))
00145 {
00146         <span class="keyword">struct </span>{ <span class="keywordtype">int</span> name; <span class="keywordtype">int</span> size; <span class="keywordtype">int</span> qtype; } arg = { name, size, qtype };
00147         <span class="keywordflow">return</span> rtai_lxrt(BIDX, SIZARG, LXRT_MBX_INIT, &amp;arg).v[LOW];
00148 }
00149 
<a name="l00164"></a><a class="code" href="group__lxrt.html#a337">00164</a> <span class="preprocessor">#define rt_mbx_init(name, size) rt_typed_mbx_init(name, size, FIFO_Q)</span>
00165 <span class="preprocessor"></span>
00166 <span class="preprocessor">#define rt_typed_named_mbx_init(mbx_name, size, qtype) \</span>
00167 <span class="preprocessor">        rt_typed_mbx_init(nam2num(mbx_name), size, qtype)</span>
00168 <span class="preprocessor"></span>
00169 <span class="preprocessor">#define rt_named_mbx_init(mbx_name, size) \</span>
00170 <span class="preprocessor">        rt_typed_named_mbx_init(mbx_name, size, FIFO_Q)</span>
00171 <span class="preprocessor"></span>
00172 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_delete,(<span class="keyword">struct</span> rt_mailbox *mbx))
00173 {
00174         <span class="keywordtype">void</span> *arg = mbx;
00175         <span class="keywordflow">return</span> rtai_lxrt(BIDX, SIZARG, LXRT_MBX_DELETE, &amp;arg).i[LOW];
00176 }
00177 
00178 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00179 {
00180         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00181         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND, &amp;arg).i[LOW];
00182 }
00183 
00184 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_wp,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00185 {
00186         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00187         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_WP, &amp;arg).i[LOW];
00188 }
00189 
00190 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_if,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00191 {
00192         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00193         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_IF, &amp;arg).i[LOW];
00194 }
00195 
00196 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_until,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME time))
00197 {
00198         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME time; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, time };
00199         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_UNTIL, &amp;arg).i[LOW];
00200 }
00201 
00202 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_send_timed,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME delay))
00203 {
00204         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME delay; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, delay };
00205         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_SEND_TIMED, &amp;arg).i[LOW];
00206 }
00207 
00208 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_ovrwr_send,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00209 {
00210         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00211         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_OVRWR_SEND, &amp;arg).i[LOW];
00212 }
00213 
00214 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_evdrp,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00215 {
00216         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00217         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_EVDRP, &amp;arg).i[LOW];
00218 }
00219 
00220 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00221 {
00222         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00223         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE, &amp;arg).i[LOW];
00224 }
00225 
00226 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_wp,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00227 {
00228         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00229         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_WP, &amp;arg).i[LOW];
00230 }
00231 
00232 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_if,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size))
00233 {
00234         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size };
00235         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_IF, &amp;arg).i[LOW];
00236 }
00237 
00238 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_until,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME time))
00239 {
00240         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">void</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME time; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, time };
00241         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_UNTIL, &amp;arg).i[LOW];
00242 }
00243 
00244 RTAI_PROTO(<span class="keywordtype">int</span>, rt_mbx_receive_timed,(<span class="keyword">struct</span> rt_mailbox *mbx, <span class="keywordtype">void</span> *msg, <span class="keywordtype">int</span> msg_size, RTIME delay))
00245 {
00246         <span class="keyword">struct </span>{ <span class="keyword">struct </span>rt_mailbox *mbx; <span class="keywordtype">char</span> *msg; <span class="keywordtype">int</span> msg_size; RTIME delay; } arg = { mbx, (<span class="keywordtype">char</span> *)msg, msg_size, delay };
00247         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rtai_lxrt(BIDX, SIZARG, MBX_RECEIVE_TIMED, &amp;arg).i[LOW];
00248 }
00249 
00250 <span class="preprocessor">#ifdef __cplusplus</span>
00251 <span class="preprocessor"></span>}
00252 <span class="preprocessor">#endif </span><span class="comment">/* __cplusplus */</span>
00253 
00254 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00255 
00256 <span class="preprocessor">#if !defined(__KERNEL__) || defined(__cplusplus)</span>
00257 <span class="preprocessor"></span>
00258 <span class="keyword">typedef</span> <span class="keyword">struct </span>rt_mailbox {
00259     <span class="keywordtype">int</span> opaque;
00260 } MBX;
00261 
00262 <span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ || __cplusplus */</span>
00263 
00264 <span class="preprocessor">#endif </span><span class="comment">/* !_RTAI_MBX_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jan 11 16:25:16 2004 for RTAI API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
